<!DOCTYPE html>
<html âš¡>
  <head>
    <meta charset="utf-8">
    <title>Analytics&#58; the Basics</title>
    <link rel="canonical" href="https://www.ampproject.org/docs/guides/analytics/analytics_basics.html">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <meta property="og:description" content="Start here to learn the basics about AMP analytics.">
    <meta name="description" content="Start here to learn the basics about AMP analytics.">
    <link rel="shortcut icon" href="/docs/assets/amp_favicon.png?v=2">

    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
    <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script>

    <style amp-custom>
    body,blockquote,pre,hr,dl,dd,ol,ul,figure{margin:0;padding:0}html,body{background-color:#fbfafb;font-family:Roboto,verdana,arial,sans-serif;margin:0;overflow-x:hidden;padding:0}body{padding-top:66px}ul li,ol li{color:#333;font-size:16px;font-weight:300;line-height:24px}p{color:#333;font-size:16px;font-weight:300;line-height:24px}.container{box-sizing:border-box;margin:0 auto;max-width:1000px;padding:0 20px}.container.md{max-width:800px}.wrap{background-color:#fff;margin:0 auto}.centered{text-align:center}@media only screen and (max-width: 870px){.centered{text-align:left}}.align-right{text-align:right}.clearfix:after{content:"";display:table;clear:both}.clearfix .left{float:left}.clearfix .right{float:right}.clearfix .fill{overflow:hidden;width:auto}h1,h2,h3,h4,h5{color:#147bc1;font-weight:300;margin-top:1.1em;margin-bottom:0.5em}h1{font-size:43px}h2{font-size:36px}h3{font-size:26px}a{color:#0360B5;text-decoration:none}a:hover{text-decoration:underline}a.button{padding:1em;display:block;background-color:#F5F5F5;text-align:center}blockquote{color:#797c82;border-left:4px solid #f5f5f5;padding-left:15px;font-size:18px;letter-spacing:-1px;font-style:italic}blockquote>:last-child{margin-bottom:0}code{font-size:15px;border:1px solid #f5f5f5;border-radius:3px}code{padding:1px 5px}table{border-collapse:collapse}td,th{border:1px solid #FFFFFF;background:#F7F7F7;padding:0.5rem;text-align:left}th{background:#eee}header{-webkit-box-shadow:rgba(0,0,0,0.15) 1px 1px 14px;-moz-box-shadow:rgba(0,0,0,0.15) 1px 1px 14px;box-shadow:rgba(0,0,0,0.15) 1px 1px 14px;font-size:14px;font-weight:300;transform:translateZ(0);backface-visibility:hidden;background-color:#fff}header .container{padding:0}@media only screen and (max-width: 870px){header .container{padding:0 10px}}header.absolute,header.fixed{-moz-transform:translateY(0%);-o-transform:translateY(0%);-ms-transform:translateY(0%);-webkit-transform:translateY(0%);transform:translateY(0%);-moz-transition:all 0.25s ease;-o-transition:all 0.25s ease;-ms-transition:all 0.25s ease;-webkit-transition:all 0.25s ease;transition:all 0.25s ease;left:0;position:fixed;top:0;width:100%;z-index:1000}header.absolute{position:absolute}header.nav--pinned,header.nav--unpinned,header.nav--top{position:fixed}@media only screen and (max-width: 870px){header.nav--pinned,header.nav--unpinned,header.nav--top{position:relative}}header.nav--pinned,header.nav--unpinned{background:#147bc1}header.nav--top{background-color:transparent}header.hidden{display:block}@media only screen and (max-width: 870px){header.hidden{-moz-transform:translateY(-100%);-o-transform:translateY(-100%);-ms-transform:translateY(-100%);-webkit-transform:translateY(-100%);transform:translateY(-100%)}}header.menu-open{transform:translate(-243px, 0px)}@media only screen and (max-width: 870px){header .wrap{color:transparent}}header .content.mobile-show{padding:0 10px 5px}header .left-nav{-webkit-box-align:center;-moz-box-align:center;box-align:center;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;display:-webkit-box;display:-moz-box;display:box;display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-moz-box-pack:start;box-pack:start;-webkit-justify-content:flex-start;-moz-justify-content:flex-start;-ms-justify-content:flex-start;-o-justify-content:flex-start;justify-content:flex-start;-ms-flex-pack:start;float:left;font-size:14px;letter-spacing:0.04em;margin-left:0}@media only screen and (max-width: 870px){header .left-nav{-webkit-box-pack:start;-moz-box-pack:start;box-pack:start;-webkit-justify-content:flex-start;-moz-justify-content:flex-start;-ms-justify-content:flex-start;-o-justify-content:flex-start;justify-content:flex-start;-ms-flex-pack:start;flex:1 1 auto;padding:0 0 5px 0;text-align:left;width:auto}}header .left-nav .header-title{background-image:url("/docs/assets/logo-blue.svg");background-position:center left;background-repeat:no-repeat;background-size:40px 40px;color:#147bc1;font-family:Roboto, verdana, arial, sans-serif;margin:10px 0;padding:15px 10px 15px 50px;text-transform:none;white-space:nowrap;width:auto}@media only screen and (max-width: 870px){header .left-nav .header-title{line-height:41px;margin:6px 0;padding:0 0 0 50px;width:auto}}@media only screen and (max-width: 870px){header .clearfix{display:flex;flex-wrap:wrap-reverse}}header .alt{padding:15px 0;text-align:right;display:-webkit-box;display:-moz-box;display:box;display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-moz-box-align:center;box-align:center;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;-webkit-box-pack:center;-moz-box-pack:center;box-pack:center;-webkit-justify-content:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-ms-flex-pack:center}header .alt.right{letter-spacing:0.04em;font-size:14px}@media only screen and (max-width: 870px){header .alt.right{float:right;text-align:center;flex:0;padding:0 0 10px;font-size:12px;display:inline-block}}header .tab{color:#147bc1;display:inline-block;padding:10px 15px;text-decoration:none;text-transform:uppercase}@media only screen and (max-width: 870px){header .tab{margin-left:auto;padding:10px 12px}}header .tab.go-button{-webkit-box-shadow:-1px 6px 6px -3px rgba(0,0,0,0.22);-moz-box-shadow:-1px 6px 6px -3px rgba(0,0,0,0.22);box-shadow:-1px 6px 6px -3px rgba(0,0,0,0.22);background-color:#147bc1;border:0;border-radius:4px;color:#fff;font-family:Roboto, verdana, arial, sans-serif;font-size:14px;font-weight:500;padding:10px 20px;margin-left:10px;text-transform:uppercase}@media only screen and (max-width: 870px){header .tab.go-button{margin-right:5px;margin-left:auto;padding:8px 10px}}header .tab.go-button:hover{text-decoration:none}header .tab.hamburger{font-size:30px;display:none}@media only screen and (max-width: 870px){header .tab.desktop{display:none}header .tab.hamburger{display:inline-block}}.main{display:-webkit-flex;display:flex;padding-top:40px;padding-bottom:30px}.main h1{margin-top:0}.main h1:before,.main h2:before,.main h3:before,.main h4:before,.main h5:before{display:block;content:" ";margin-top:-106px;height:106px;visibility:hidden}.main .content{flex-grow:1;-webkit-flex-grow:1;transition:all 0.25s ease;transform:translate(0, 0);will-change:transform;word-break:break-word;min-width:0}.main .content.menu-open{transform:translate(-243px, 0)}.main .content ul,.main .content ol{margin-left:40px}.main .content{overflow-wrap:break-word;word-wrap:break-word;-ms-word-break:break-all;word-break:break-all;word-break:break-word;-ms-hyphens:auto;-moz-hyphens:auto;-webkit-hyphens:auto;hyphens:auto}.main amp-img,.main amp-youtube,.main amp-iframe{margin:1em 0}nav{border-right:2px solid #E6E6E6;padding:20px;margin-right:30px;margin-left:-20px;width:200px;flex-shrink:0;-webkit-flex-shrink:0;background:#F7F7F7;margin-top:-40px;margin-bottom:-30px}nav h2{font-size:20px;color:#111;margin-top:0;margin-bottom:10px}nav ul li,nav ol li{margin-bottom:10px;list-style:none}nav ul li ul,nav ul li ol,nav ol li ul,nav ol li ol{padding-left:0;margin-left:20px;margin-bottom:1.2em}nav ul li ul li,nav ul li ol li,nav ol li ul li,nav ol li ol li{margin-bottom:6px;font-size:14px;list-style:square;color:#CECECE}nav ul li ul li.current,nav ul li ol li.current,nav ol li ul li.current,nav ol li ol li.current{color:#222}nav ul li ul li span,nav ul li ol li span,nav ol li ul li span,nav ol li ol li span{font-weight:400;color:#222}nav ul li ul li ul,nav ul li ul li ol,nav ul li ol li ul,nav ul li ol li ol,nav ol li ul li ul,nav ol li ul li ol,nav ol li ol li ul,nav ol li ol li ol{margin-bottom:0;margin-left:0;padding-left:20px;border-top:1px solid #eee;padding-top:3px;padding-bottom:0px}nav ul li ul li ol li,nav ul li ol li ol li,nav ol li ul li ol li,nav ol li ol li ol li{list-style:decimal}@media only screen and (max-width: 870px){nav{-webkit-order:1;order:1;border-left:2px solid #E6E6E6;margin-left:30px;margin-right:0;border-right:none;margin-top:0;position:absolute;top:0;right:0;transform:translate(243px, 0);transition:all 0.25s ease;will-change:transform}nav.menu-open{transform:translate(0, 0)}}pre{overflow:auto;tab-size:2;word-break:normal;line-height:1.4;background:#F7F7F7}pre>code{white-space:pre;word-wrap:initial;display:block}pre>code td{border:0}.highlight .hll{background-color:#ffc}.highlight .c{color:#aaaaaa;font-style:italic}.highlight .err{color:#F00000}.highlight .k{color:#00a}.highlight .cm{color:#aaaaaa;font-style:italic}.highlight .cp{color:#4c8317}.highlight .c1{color:#aaaaaa;font-style:italic}.highlight .cs{color:#0000aa;font-style:italic}.highlight .gd{color:#a00}.highlight .ge{font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#000080;font-weight:bold}.highlight .gi{color:#0a0}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#800080;font-weight:bold}.highlight .gt{color:#a00}.highlight .kc{color:#00a}.highlight .kd{color:#00a}.highlight .kn{color:#00a}.highlight .kp{color:#00a}.highlight .kr{color:#00a}.highlight .kt{color:#0aa}.highlight .m{color:#099}.highlight .s{color:#a50}.highlight .na{color:#1e90ff}.highlight .nb{color:#0aa}.highlight .nc{color:#00aa00;text-decoration:underline}.highlight .no{color:#a00}.highlight .nd{color:#888}.highlight .ni{color:#800000;font-weight:bold}.highlight .nf{color:#0a0}.highlight .nn{color:#00aaaa;text-decoration:underline}.highlight .nt{color:#1e90ff;font-weight:bold}.highlight .nv{color:#a00}.highlight .ow{color:#00a}.highlight .w{color:#bbb}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .sb{color:#a50}.highlight .sc{color:#a50}.highlight .sd{color:#a50}.highlight .s2{color:#a50}.highlight .se{color:#a50}.highlight .sh{color:#a50}.highlight .si{color:#a50}.highlight .sx{color:#a50}.highlight .sr{color:#099}.highlight .s1{color:#a50}.highlight .ss{color:#00a}.highlight .bp{color:#0aa}.highlight .vc{color:#a00}.highlight .vg{color:#a00}.highlight .vi{color:#a00}.highlight .il{color:#099}.highlight .lineno{-webkit-user-select:none;-moz-user-select:none;-o-user-select:none}.lineno::-moz-selection{background-color:transparent}.lineno::selection{background-color:transparent}footer{padding:40px 0 60px 100px;background-color:#f5f5f5}footer p{margin:0}footer .footer-image{height:25px;width:25px;padding-left:25px;float:right}
    </style>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:200,300,400,500,700">
  </head>

  <body>
<amp-analytics type="googleanalytics" id="analytics-ga">
<script type="application/json">
{
  "vars": {
    "account": "UA-67833617-1"
  },
  "triggers": {
    "trackPageview": {
      "on": "visible",
      "request": "pageview"
    }
  }
}
</script>
</amp-analytics>

    <header class="fixed">
      <div class="wrap">
        <div class="container">
          <div class="clearfix">
          <div class="left-nav">
              <a href="https://ampproject.org" class="tab header-title">
                Accelerated
                Mobile
                Pages
                Project
              </a>
            </div>
            <div class="right alt">
              <a class="tab desktop" href="/docs/support/faqs.html">
                FAQ
              </a>
              <a class="tab desktop" href="https://amphtml.wordpress.com">
                Blog
              </a>
              <a class="tab desktop" href="https://github.com/ampproject/amphtml">
                GitHub
              </a>
              <a class="tab desktop" href="/docs/get_started/about-amp.html">
                Docs
              </a>
              <a class="tab hamburger" id="menu-button" href="">&#x2261;</a>
            </div>
          </div>
        </div>
      </div>
    </header>


    <div class="wrap">
      <div class="container main">
        
        <nav>
          <ul>
            
            

            <li>
            <h2>Get Started</h2>

            <ul>
              
              
              
              
              

                
                

                
                
                <li>
                  <a href="/docs/get_started/about-amp.html">What Is AMP?</a>
                

                

                </li>
                

              
              
              

                
                

                

              
              
              

                
                

                

              
              
              

                
                

                
                
                <li>
                  <a href="/docs/get_started/create_page.html">Create Your First AMP Page</a>
                

                

                </li>
                

              
              
              

                
                

                

              
              
              

                
                

                
                
                <li>
                  <a href="/docs/get_started/technical_overview.html">How AMP Speeds Up Performance</a>
                

                

                </li>
                

              
              
              

                
                

                

              
              
              

                
                

                

              
              
              

                
                

                

              
              
            </ul>
            </li>
            
            
            

            <li>
            <h2>Guides</h2>

            <ul>
              
              
              

                
                

                

              
              
              

                
                

                

              
              
              

                
                

                
                
                <li>
                  <a href="/docs/guides/responsive_amp.html">Create Responsive AMP Pages</a>
                

                

                </li>
                

              
              
              

                
                

                
                
                <li>
                  <a href="/docs/guides/amp_replacements.html">Include Iframes and Media</a>
                

                

                </li>
                

              
              
              

                
                

                

              
              
              

                
                

                

              
              
              

                
                

                

              
              
              

                
                

                
                
                <li>
                  <a href="/docs/guides/third_party_components.html">Include Third-Party Content</a>
                

                

                </li>
                

              
              
              

                
                

                
                
                <li>
                  <a href="/docs/guides/discovery.html">Make Your Page Discoverable</a>
                

                

                </li>
                

              
              
              

                
                

                
                
                <li>
                  <a href="/docs/guides/validate.html">Validate AMP Pages</a>
                

                

                </li>
                

              
              
              

                
                

                
                
                <li>
                  <a href="/docs/guides/analytics_amp.html">Configure Analytics</a>
                

                
                  <ul>
                  

                    
                    

                    
                    
                    
                    
                    <li class="current">
                      <span>Analytics&#58; the Basics</span>
                    </li>
                    
                    

                  

                    
                    

                    
                    

                  

                    
                    

                    
                    

                  

                    
                    

                    
                    

                  

                    
                    

                    
                    
                    
                    
                    <li>
                      <a href="/docs/guides/analytics/deep_dive_analytics.html">Deep Dive into AMP Analytics</a>
                    </li>
                    
                    

                  

                    
                    

                    
                    

                  

                    
                    

                    
                    
                    
                    
                    <li>
                      <a href="/docs/guides/analytics/use_cases.html">Use Cases</a>
                    </li>
                    
                    

                  

                    
                    

                    
                    

                  

                    
                    

                    
                    

                  

                    
                    

                    
                    

                  

                    
                    

                    
                    

                  
                  </ul>
                

                </li>
                

              
              
            </ul>
            </li>
            
            
            

            <li>
            <h2>Reference</h2>

            <ul>
              
              
              

                
                

                
                
                <li>
                  <a href="/docs/reference/experimental.html">Experimental Components</a>
                

                

                </li>
                

              
              
              

                
                

                
                
                <li>
                  <a href="/docs/reference/validation_errors.html">AMP Validation Errors</a>
                

                

                </li>
                

              
              
            </ul>
            </li>
            
            
            

            <li>
            <h2>Support</h2>

            <ul>
              
              
              
              
              

                
                

                
                
                <li>
                  <a href="/docs/support/faqs.html">FAQ</a>
                

                

                </li>
                

              
              
              

                
                

                
                
                <li>
                  <a href="https://amphtml.wordpress.com">Blog</a>
                

                

                </li>
                

              
              
              

                
                

                
                
                <li>
                  <a href="https://stackoverflow.com/questions/tagged/amp-html">Stack Overflow</a>
                

                

                </li>
                

              
              
              

                
                

                
                
                <li>
                  <a href="/docs/support/contribute.html">How to Contribute</a>
                

                

                </li>
                

              
              
            </ul>
            </li>
            
            
            
            
          </ul>
        </nav>
        

        <div class="content">
          <!-- article -->
          <article class="post">

    <h1 class="post-title">Analytics&#58; the Basics</h1>

	<div class="post-content">
	    <p>Start here to learn the basics about AMP analytics.</p>

<ul id="markdown-toc">
  <li><a href="#use-amp-pixel-or-amp-analytics" id="markdown-toc-use-amp-pixel-or-amp-analytics">Use amp-pixel or amp-analytics?</a></li>
  <li><a href="#create-a-simple-analytics-configuration" id="markdown-toc-create-a-simple-analytics-configuration">Create a simple analytics configuration</a>    <ul>
      <li><a href="#simple-amp-pixel-configuration" id="markdown-toc-simple-amp-pixel-configuration">Simple amp-pixel configuration</a></li>
      <li><a href="#simple-amp-analytics-configuration" id="markdown-toc-simple-amp-analytics-configuration">Simple amp-analytics configuration</a></li>
    </ul>
  </li>
  <li><a href="#variable-substitution" id="markdown-toc-variable-substitution">Variable substitution</a></li>
  <li><a href="#user-identification" id="markdown-toc-user-identification">User identification</a></li>
</ul>

<h2 id="use-amp-pixel-or-amp-analytics">Use amp-pixel or amp-analytics?</h2>

<p>AMP provides two components to meet your analytics and measurement needs:
<a href="/docs/reference/amp-pixel.html">amp-pixel</a> and
<a href="/docs/reference/extended/amp-analytics.html">amp-analytics</a>.
Both options send analytics data to a defined endpoint.</p>

<p>If you are looking for behavior like a simple
<a href="https://en.wikipedia.org/wiki/Web_beacon#Implementation">tracking pixel</a>,
the <code class="highlighter-rouge">amp-pixel</code> component provides basic page view tracking;
page view data gets sent to a defined URL.
Some integrations with a vendor may call for this component,
in which case they will specify the exact URL endpoint.</p>

<p>For most analytics solutions, use <code class="highlighter-rouge">amp-analytics</code>.
Page view tracking works in <code class="highlighter-rouge">amp-analytics</code> too.
But you can also track user engagement with any type of page content,
including clicks on links and buttons.
And you can measure how far on the page the user scrolled,
whether or not the user engaged with social media, and more
(see
<a href="/docs/guides/analytics/deep_dive_analytics.html">Deep Dive into AMP Analytics</a>).</p>

<p>As part of integrating with the AMP platform,
providers have offered pre-defined <code class="highlighter-rouge">amp-analytics</code> configurations
so that itâ€™s easy to capture data and push to their tracking tools.
Access vendor documentation from the
<a href="/docs/reference/extended/amp-analytics.html">amp-analytics specification</a>.</p>

<p>You can use both <code class="highlighter-rouge">amp-pixel</code> and <code class="highlighter-rouge">amp-analytics</code> in your pages:
<code class="highlighter-rouge">amp-pixel</code> for simple page view tracking,
and <code class="highlighter-rouge">amp-analytics</code> for everything else.
You can also add multiples of each tag.
If youâ€™re working with multiple analytics providers,
you will need one tag per solution.
Keep in mind that simpler AMP pages are better for users,
so if you donâ€™t need the extra tags, donâ€™t use them.</p>

<h2 id="create-a-simple-analytics-configuration">Create a simple analytics configuration</h2>

<p>Learn how to create a simple
<a href="/docs/reference/amp-pixel.html">amp-pixel</a> and
<a href="/docs/reference/extended/amp-analytics.html">amp-analytics</a> configuration.</p>

<h3 id="simple-amp-pixel-configuration">Simple amp-pixel configuration</h3>

<p>To create a simple <code class="highlighter-rouge">amp-pixel</code> configuration,
insert something like the following into the body of your AMP page:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;amp-pixel</span> <span class="na">src=</span><span class="s">"https://foo.com/pixel?RANDOM"</span><span class="nt">&gt;&lt;/amp-pixel&gt;</span></code></pre></figure>

<p>In this example,
the page view data gets sent to the defined URL, along with a random number.
The <code class="highlighter-rouge">RANDOM</code> variable is one of many
<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md">substitution variables in the AMP platform</a>.
Learn more about
<a href="/docs/guides/analytics/analytics_basics.html#variable-substitution">Variable substitution</a> here.</p>

<p>The <a href="/docs/reference/amp-pixel.html">amp-pixel</a>
component is built-in,
so you wonâ€™t need an inclusion declaration like you do
for AMPâ€™s extended components, including <code class="highlighter-rouge">amp-analytics</code>.
But you should place the <code class="highlighter-rouge">amp-pixel</code> tag as close as possible
to the start of your <code class="highlighter-rouge">&lt;body&gt;</code>.
The tracking pixel will only fire when the tag comes into view itself.
If <code class="highlighter-rouge">amp-pixel</code> is positioned near the bottom of the page,
it may not fire.</p>

<h3 id="simple-amp-analytics-configuration">Simple amp-analytics configuration</h3>

<p>To create a simple
<a href="/docs/reference/extended/amp-analytics.html">amp-analytics</a> configuration,
you must first include this <code class="highlighter-rouge">custom-element</code> declaration
in the <code class="highlighter-rouge">&lt;head&gt;</code> of the AMP document (see also
<a href="/docs/reference/extended.html#component-inclusion-declaration">Component inclusion declaration</a>):</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;script </span><span class="na">async</span> <span class="na">custom-element=</span><span class="s">"amp-analytics"</span> <span class="na">src=</span><span class="s">"https://cdn.ampproject.org/v0/amp-analytics-0.1.js"</span><span class="nt">&gt;&lt;/script&gt;</span></code></pre></figure>

<p>The following example is similar to the <a href="/docs/guides/analytics/analytics_basics.html#simple-amp-pixel-configuration"><code class="highlighter-rouge">amp-pixel</code> example</a>.
Everytime a page is visible,
the trigger event fires, and
sends the pageview data to a defined URL along with a random ID:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;amp-analytics&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"application/json"</span><span class="nt">&gt;</span>
<span class="p">{</span>
  <span class="s2">"requests"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"pageview"</span><span class="err">:</span> <span class="s2">"https://foo.com/pixel?RANDOM"</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="s2">"triggers"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"trackPageview"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"on"</span><span class="err">:</span> <span class="s2">"visible"</span><span class="p">,</span>
      <span class="s2">"request"</span><span class="err">:</span> <span class="s2">"pageview"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/amp-analytics&gt;</span></code></pre></figure>

<p>In the above example, we have defined a request called pageview to be https://foo.com/pixel?RANDOM. As discussed earlier, RANDOM is substituted by a random number, so the request will actually end up looking like https://foo.com/pixel?0.23479283687235653498734.</p>

<p>When the page becomes visible
(as specified by the use of the trigger keyword <code class="highlighter-rouge">visible</code>),
an event triggers and the <code class="highlighter-rouge">pageview</code> request is sent.
The triggers attribute determines when the pageview request fires.
Learn more about <a href="/docs/guides/analytics/deep_dive_analytics.html#requests-triggers--transports">requests and triggers</a>.</p>

<h2 id="variable-substitution">Variable substitution</h2>

<p>Both the <a href="/docs/reference/amp-pixel.html">amp-pixel</a> and
<a href="/docs/reference/extended/amp-analytics.html">amp-analytics</a> components
allow all standard URL variable substitutions (see
<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md">AMP HTML Variable Substitutions</a>).
In the following example,
the page view request is sent to the URL,
along with the current AMP documentâ€™s canonical URL, its title, and a
<a href="/docs/guides/analytics/analytics_basics.html#user-identification">client ID</a>:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;amp-pixel</span> <span class="na">src=</span><span class="s">"https://example.com/analytics?url=${canonicalUrl}&amp;title=${title}&amp;clientId=${clientId(site-user-id)}"</span><span class="nt">&gt;&lt;/amp-pixel&gt;</span></code></pre></figure>

<p>Due to its simplicity,
the <code class="highlighter-rouge">amp-pixel</code> tag can only include variables defined by the platform
or that the AMP runtime can parse from the AMP page.
In the above example,
the platform populates the values for both
<code class="highlighter-rouge">canonicalURL</code> and <code class="highlighter-rouge">clientId(site-user-id)</code>.
The <code class="highlighter-rouge">amp-analytics</code> tag can include the same variables as <code class="highlighter-rouge">amp-pixel</code>,
as well as uniquely defined variables inside the tag configuration.</p>

<p>Use the format <code class="highlighter-rouge">${varName}</code> in a request string for a page
or platform-defined variable.
The <code class="highlighter-rouge">amp-analytics</code> tag will replace the template with its actual value
at the time of construction of the analytics request (see also
<a href="https://github.com/ampproject/amphtml/blob/master/extensions/amp-analytics/analytics-vars.md">Variables supported in amp-analytics</a>).</p>

<p>In the following <code class="highlighter-rouge">amp-analytics</code> example,
the page view request is sent to the URL,
with additional data extracted from variable substitutions,
some provided by the platform,
some defined inline,
within the <code class="highlighter-rouge">amp-analytics</code> configuration:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;amp-analytics&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"application/json"</span><span class="nt">&gt;</span>
<span class="p">{</span>
  <span class="s2">"requests"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"pageview"</span><span class="err">:</span><span class="s2">"https://example.com/analytics?url=${canonicalUrl}&amp;title=${title}&amp;acct=${account}&amp;clientId=${clientId(site-user-id)}"</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="s2">"vars"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"account"</span><span class="err">:</span> <span class="s2">"ABC123"</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="s2">"triggers"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"someEvent"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"on"</span><span class="err">:</span> <span class="s2">"visible"</span><span class="p">,</span>
      <span class="s2">"request"</span><span class="err">:</span> <span class="s2">"pageview"</span><span class="p">,</span>
      <span class="s2">"vars"</span><span class="err">:</span> <span class="p">{</span>
        <span class="s2">"title"</span><span class="err">:</span> <span class="s2">"My homepage"</span><span class="p">,</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>  
<span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/amp-analytics&gt;</span></code></pre></figure>

<p>In the above example,
the variables, <code class="highlighter-rouge">account</code> and <code class="highlighter-rouge">title</code> are defined
in the <code class="highlighter-rouge">amp-analytics</code> configuration.
The <code class="highlighter-rouge">canonicalUrl</code> and <code class="highlighter-rouge">clientId</code> variables arenâ€™t defined in the configuration,
so their values get substituted by the platform.</p>

<p><strong>Important:</strong> Variable substitution is flexible;
you can have the same variables defined in different locations,
and the AMP runtime will parse the values in this order of precedence
(see <a href="/docs/guides/analytics/deep_dive_analytics.html#variable-substitution-ordering">Variable substitution ordering</a>).</p>

<h2 id="user-identification">User identification</h2>

<p>Websites use cookies to store information specific to a user in the browser.
Cookies can be used to tell that a user has visited a site before.
In AMP,
pages can be served from either a publisherâ€™s website or a cache
(like the Google AMP Cache).
The publisherâ€™s website and the cache are likely to have different domains.
For security reasons,
browsers can (and often will) limit access to another domainâ€™s cookies
(see also
<a href="https://github.com/ampproject/amphtml/blob/master/extensions/amp-analytics/cross-origin-tracking.md">Tracking users across origins</a>).</p>

<p>By default,
AMP will manage the provision of a client ID whether the page is accessed from the publisherâ€™s original website or through a cache.
The AMP-generated client ID has a value of <code class="highlighter-rouge">"amp-"</code>
followed by a random <code class="highlighter-rouge">base64</code> encoded string and remains the same
for the user if that same user visits again.</p>

<p>AMP manages reading and writing of the client ID in all cases.
This is particularly notable in the case when a page is served
via a cache or otherwise shown outside the viewing context
of the publisherâ€™s original site.
In this circumstance, access to the publisher siteâ€™s cookies is unavailable.</p>

<p>When an AMP page is served from a publisherâ€™s site,
the client ID framework that AMP uses can be told about a fallback cookie
to look for and use.
In this case,
the <code class="highlighter-rouge">cid-scope-cookie-fallback-name</code> argument of the <code class="highlighter-rouge">clientId</code> variable
is interpreted as a cookie name.
The formatting may appear as either
<code class="highlighter-rouge">CLIENT_ID(cid-scope-cookie-fallback-name)</code> or
<code class="highlighter-rouge">${clientId(cid-scope-cookie-fallback-name)}</code>.</p>

<p>For example:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;amp-pixel</span> <span class="na">src=</span><span class="s">"https://foo.com/pixel?cid=CLIENT_ID(site-user-id-cookie-fallback-name)"</span><span class="nt">&gt;&lt;/amp-pixel&gt;</span></code></pre></figure>

<p>If AMP finds that this cookie is set,
then the client ID substitution will return the cookieâ€™s value.
If the AMP finds that this cookie is not set,
then AMP will generate a value of the form <code class="highlighter-rouge">amp-</code> followed
by a random base64 encoded string.</p>

<p>Learn more about client ID substitution,
including how to add an optional user notification ID, in
<a href="https://github.com/ampproject/amphtml/blob/master/extensions/amp-analytics/analytics-vars.md">Variables supported in AMP analytics</a>.</p>

	</div>

</article>

          <!-- /article -->
        </div>
      </div>
    </div>

    <footer>
      <div class="container">
        <div class="row">
          <div class="twelve columns">
          </div>
        </div>
    </footer>
    <script>
    document.getElementById('menu-button').onclick = function() {
      document.getElementsByTagName('header')[0].classList.toggle('menu-open');
      document.querySelector('div.content').classList.toggle('menu-open');
      document.querySelector('nav').classList.toggle('menu-open');
      return false;
    };
    </script>
  </body>
</html>
